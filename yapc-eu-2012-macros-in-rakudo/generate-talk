#! /usr/local/bin/nom

my $template = slurp('template');
my $slides = slurp('slides');

sub put_in_div($t) {
    "<div>\n$t\n</div>"
}

sub linebreaks_to_brs($t) {
    $t.lines.join("<br />\n");
}

sub convert_icons($t) {
    $t.subst(/'[' (\S+) ']'/, -> $/ { "<i class='icon-$0'></i>" }, :g);
}

sub handle_slide($slide) {
    put_in_div
    linebreaks_to_brs
    convert_icons
    $slide
}

my $divider = /\n+ '--' \n+/;
my $content = $slides.trim.split($divider).map(&handle_slide).join("\n\n");
my $document = $template.subst('{{{content}}}', $content);

spurt('talk.html', $document);
