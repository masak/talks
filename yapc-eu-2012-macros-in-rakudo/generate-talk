#! /usr/local/bin/nom

my $HEADER = slurp('header');
my $FOOTER = slurp('footer');
my $content = slurp('slides');

sub put_in_div($t) {
    "<div>\n$t\n</div>"
}

sub linebreaks_to_brs($t) {
    $t.lines.join("<br />\n");
}

sub convert_icons($t) {
    $t.subst(/'[' (\w+) ']'/, -> $/ { "<i class='icon-$0'></i>" }, :g);
}

my $BODY = $content.trim.split(/\n+ '--' \n+/).map({
    put_in_div
    linebreaks_to_brs
    convert_icons
    $_
}).join("\n\n");

given open('talk.html', :w) {
    .print($HEADER);
    .print($BODY);
    .print($FOOTER);

    .close();
}
