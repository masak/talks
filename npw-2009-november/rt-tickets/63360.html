<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>#63360: [PATCH] Update configure script and makefiles for installed Parrot</title>
    <link rel="shortcut icon" href="/rt3/NoAuth/images//favicon.png" type="image/png" />
    <link rel="stylesheet" href="/rt3/NoAuth/css/rt.perl.org/main.css" type="text/css" media="all" />
    <link rel="stylesheet" href="/rt3/NoAuth/css/print.css" type="text/css" media="print" />
    <script type="text/javascript" src="/rt3/NoAuth/js/util.js"></script>
    <script type="text/javascript" src="/rt3/NoAuth/js/titlebox-state.js"></script>
    <script type="text/javascript"><!--
        onLoadHook("loadTitleBoxStates()");
    --></script>

  </head>
  <body id="comp-Public-Bug-Display">

  <div id="logo">
    <a href="http://rt.perl.org/rt3/"><img src="/rt3/NoAuth/images//local/pblogo.gif" alt="PerlBug" width="230" height="50"></a>
  </div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
    You are currently an anonymous guest.
    |
    <a href="/rt3/NoAuth/Logout.html?URL=/rt3/index.html?goto=%252FPublic%252FBug%252FDisplay.html%253Fid%253D63360">Login</a>
    |
    <a href="/rt3/NoAuth/Logout.html">Return to Main</a>
   | <a href="/rt3/User/Prefs.html">Preferences</a>
  

  </div>



  <div id="topactions">
    <span class="topaction">
<form action="/rt3/Public/Search/Simple.html">
  <input size="12" name="q" autocomplete="off" accesskey="0" class="field" />
  <input type="submit" class="button" value="Search" />
</form>
    </span>
  </div>

</div>

<div id="nav">
<ul id="system-menu">
<div><div class="wrapper">
</div></div>
</ul>



</div>

<div id="header">
  <h1>#63360: [PATCH] Update configure script and makefiles for installed Parrot</h1>

  <ul id="page-menu">
    <div><div><div>
&nbsp;
    </div></div></div>
  </ul>

</div>

<div id="body">





<a name="skipnav" id="skipnav" accesskey="8"></a>




<div class="">
  <div class="titlebox " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html------Report information---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left">Report information</span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html------Report information---0">



      <table width="100%" class="ticket-summary">
      <tr>
	<td valign="top" width="50%" class="boxcontainer">
	  <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html--ticket-info-basics----The Basics---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left"><a href="/rt3/Ticket/Modify.html?id=63360">The Basics</a></span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html--ticket-info-basics----The Basics---0">



	        <table>
  <tr>
    <td class="label id">Id:</td>
    <td class="value id">63360</td>
  </tr>
  <tr>
    <td class="label status">Status:</td>
    <td class="value status">open</td>
  </tr>
  <tr>
    <td class="label time left">Left:</td>
    <td class="value time left">0 min
</td>
  </tr>
  <tr>
    <td class="label priority">Priority:</td>
    <td class="value priority">0/0</td>
  </tr>
  <tr>
    <td class="label queue">Queue:</td>
    <td class="value queue">perl6
</td>
  </tr>

</table>

	      <hr class="clear" />
  </div>
</div>




</div>


	  
      <div class="ticket-info-people">
  <div class="titlebox ticket-info-people" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html--ticket-info-people----People---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left"><a href="/rt3/Ticket/ModifyPeople.html?id=63360">People</a></span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html--ticket-info-people----People---0">



            <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">

Nobody

</td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">


allison [at] perl.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

	      <hr class="clear" />
  </div>
</div>




</div>



	</td>
	<td valign="top" width="50%" class="boxcontainer">
    
	  <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html--ticket-info-cfs----Bug Information---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left"><a href="/rt3/Ticket/Modify.html?id=63360">Bug Information</a></span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html--ticket-info-cfs----Bug Information---0">


 
	        <table>
  <tr id="CF-18-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19-ShowRow">
    <td class="label">Tag:</td>
    <td class="value">
Patch    </td>
  </tr>
  <tr id="CF-20-ShowRow">
    <td class="label">Platform:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-21-ShowRow">
    <td class="label">Patch Status:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


	      <hr class="clear" />
  </div>
</div>




</div>



	  <div class="">
  <div class="titlebox " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html------Attachments---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left">Attachments</span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html------Attachments---0">





rakudo_test_from_installed_parrot.patch<br />
<ul>


<li><font size="-2">
<a href="/rt3/Ticket/Attachment/535378/253866/rakudo_test_from_installed_parrot.patch">
Mon Feb 23 18:05:50 2009 (2.1k) by allison
</a>
</font></li>
</ul>


build-from-installed-parrot.patch<br />
<ul>


<li><font size="-2">
<a href="/rt3/Ticket/Attachment/534550/253404/build-from-installed-parrot.patch">
Fri Feb 20 00:36:36 2009 (10.8k) by allison <!-- x --> at perl.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>



<br />



	</td>
      </tr>
    </table>





    <hr class="clear" />
  </div>
</div>




</div>



<br />




<div class="titlebox " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html------History---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left">History</span>
    <span class="right"><span style="color: black">Display mode:</span> <span class="selected">Brief headers</span> &mdash; <a href="/rt3/Ticket/Display.html?ShowHeaders=1;id=63360">Full headers</a></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html------History---0">




<div id="ticket-history">
<div class="ticket-transaction message odd">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-534550" href="/rt3/Ticket/Display.html?id=63360#txn-534550">#</a>
      &nbsp;
    </td>
    <td class="date">Fri&nbsp;Feb&nbsp;20&nbsp;00:36:36&nbsp;2009</td>
    <td class="description">
      allison <!-- x --> at perl.org -  Ticket created
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value">[PATCH] Update configure script and makefiles for installed Parrot</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value">Fri, 20 Feb 2009 00:36:00 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value">rakudobug <!-- x --> at perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value">Allison Randal &lt;allison <!-- x --> at perl.org&gt;</td>
  </tr>
</table>
<div class="messagebody">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/534550/253402/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 1k]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
The attached git patch updates Rakudo&#39;s Configure.pl and Makefile.in to <br />
configure and build on an installed Parrot. It also adds two makefile <br />
templates for building Rakudo&#39;s dynops and dynpmcs. Notes:<br />
<br />
- This patch will only work for Parrot r36904 or later. &#40;Parrot needed <br />
changes to the install process and tools libraries to allow running a <br />
language build from an installed Parrot. Also added a script for full <br />
makefile template processing, including conditional lines #IF, #ELSIF, <br />
#ELSE, #UNLESS.&#41;<br />
<br />
- It requires a &#39;dynext/&#39; directory in the Rakudo build directory. <br />
&#40;&#39;dynext/&#39;, &#39;library/&#39;, and &#39;includes/&#39; are the standard Parrot search <br />
paths, and will work in the language build directory or installed in <br />
&#39;languages/langname/&#39; or &#39;/install/path/languages/langname/&#39;&#41;<br />
<br />
- The change *only* uses an installed Parrot &#40;no longer uses Parrot <br />
build directory paths&#41;, but it can be installed anywhere &#40;even within <br />
the Rakudo build directory, if desired&#41;.<br />
<br />
- There&#39;s still a problem with the installed test libraries. I&#39;ll look <br />
into it and provide an additional patch.<br />
<br />
Allison<br />
</div>
</div>
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/534550/253404/build-from-installed-parrot.patch">Download build-from-installed-parrot.patch</a>
<span class="downloadcontenttype">
[text/x-patch 10.8k]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
From 1d65fcb4f184ca7d8c1feaeb16fef70c919f9e88 Mon Sep 17 00:00:00 2001<br />
From: Allison Randal &lt;allison <!-- x --> at parrot.org&gt;<br />
Date: Thu, 19 Feb 2009 23:45:12 -0800<br />
Subject: [PATCH] Update Configure.pl and Makefile.in to configure and build from an installed Parrot. Add two new makefiles for building dynops and dynpmcs.<br />
<br />
---<br />
 Configure.pl          |   41 +++++++++++++++-------------<br />
 build/Makefile.in     |   48 +++++++++++++-------------------<br />
 build/ops_makefile.in |   56 +++++++++++++++++++++++++++++++++++++<br />
 build/pmc_makefile.in |   73 +++++++++++++++++++++++++++++++++++++++++++++++++<br />
 4 files changed, 171 insertions&#40;+&#41;, 47 deletions&#40;-&#41;<br />
 create mode 100644 build/ops_makefile.in<br />
 create mode 100644 build/pmc_makefile.in<br />
<br />
diff --git a/Configure.pl b/Configure.pl<br />
index 2b19fda..1fc5521 100644<br />
--- a/Configure.pl<br />
+++ b/Configure.pl<br />
@@ -50,7 +50,7 @@ END<br />
 }<br />
 <br />
<div class="message-stanza-depth-1">
 #  Create the Makefile using the information we just got<br />
</div>
-create_makefile&#40;%config&#41;;<br />
+create_makefiles&#40;%config&#41;;<br />
 <br />
<div class="message-stanza-depth-1">
 #  Done.<br />
</div>
 done&#40;&#41;;<br />
@@ -90,28 +90,31 @@ sub read_parrot_config {<br />
 }<br />
 <br />
 <br />
-#  Generate a Makefile from a configuration<br />
-sub create_makefile {<br />
+#  Generate Makefiles from a configuration<br />
+sub create_makefiles {<br />
     my %config = @_;<br />
-    open my $ROOTIN, &#34;&lt;build/Makefile.in&#34; or<br />
-        die &#34;Unable to read build/Makefile.in \n&#34;;<br />
-    my $maketext = join&#40;&#39;&#39;, &lt;$ROOTIN&gt;&#41;;<br />
-    close $ROOTIN;<br />
-<br />
-    $config{&#39;win32_libparrot_copy&#39;} = $^O eq &#39;MSWin32&#39; ? &#39;copy $&#40;BUILD_DIR&#41;\libparrot.dll .&#39; : &#39;&#39;;<br />
-    $maketext =~ s/@&#40;\w+&#41;@/$config{$1}/g;<br />
-    if &#40;$^O eq &#39;MSWin32&#39;&#41; {<br />
-        $maketext =~ s{/}{\\}g;<br />
+    my %makefiles = &#40;<br />
+        &#34;build/Makefile.in&#34; =&gt; &#34;Makefile&#34;,<br />
+        &#34;build/pmc_makefile.in&#34; =&gt; &#34;src/pmc/Makefile&#34;,<br />
+        &#34;build/ops_makefile.in&#34; =&gt; &#34;src/ops/Makefile&#34;,<br />
+    &#41;;<br />
+    my $build_tool = $config{perl} . &#34; &#34; <br />
+        . $config{libdir}<br />
+        . $config{versiondir}<br />
+        . $config{slash}<br />
+        . &#34;tools&#34;<br />
+        . $config{slash}<br />
+        . &#34;dev&#34;<br />
+        . $config{slash}<br />
+        . &#34;gen_makefile.pl&#34;;<br />
+<br />
+    foreach my $template &#40;keys %makefiles&#41; {<br />
+        my $makefile = $makefiles{$template};<br />
+       print &#34;Creating $makefile\n&#34;;<br />
+        system&#40;&#34;$build_tool $template $makefile&#34;&#41;;<br />
     }<br />
-<br />
-    print &#34;Creating Makefile\n&#34;;<br />
-    open&#40;MAKEFILE, &#34;&gt;Makefile&#34;&#41; ||<br />
-        die &#34;Unable to write Makefile\n&#34;;<br />
-    print MAKEFILE $maketext;<br />
-    close&#40;MAKEFILE&#41;;<br />
 }<br />
 <br />
-<br />
 sub done {<br />
     my $make = $config{&#39;make&#39;};<br />
     print &lt;&lt;&#34;END&#34;;<br />
diff --git a/build/Makefile.in b/build/Makefile.in<br />
index 5a00f3e..b486b23 100644<br />
--- a/build/Makefile.in<br />
+++ b/build/Makefile.in<br />
@@ -5,7 +5,10 @@<br />
 PARROT_ARGS =<br />
 <br />
<div class="message-stanza-depth-1">
 # values from parrot_config<br />
</div>
-BUILD_DIR     = @build_dir@<br />
+VERSION_DIR   = @versiondir@<br />
+LIB_DIR       = @libdir@$&#40;VERSION_DIR&#41;<br />
+BIN_DIR       = @bindir@<br />
+TOOLS_DIR     = @libdir@$&#40;VERSION_DIR&#41;@slash@tools@slash@lib<br />
 LOAD_EXT      = @load_ext@<br />
 O             = @o@<br />
 EXE           = @exe@<br />
@@ -14,24 +17,21 @@ PERL          = @perl@<br />
 RM_F          = @rm_f@<br />
 <br />
<div class="message-stanza-depth-1">
 # Various paths<br />
</div>
-PARROT_DYNEXT = $&#40;BUILD_DIR&#41;/runtime/parrot/dynext<br />
-PERL6GRAMMAR  = $&#40;BUILD_DIR&#41;/runtime/parrot/library/PGE/Perl6Grammar.pbc<br />
-NQP           = $&#40;BUILD_DIR&#41;/compilers/nqp/nqp.pbc<br />
-PCT           = $&#40;BUILD_DIR&#41;/runtime/parrot/library/PCT.pbc<br />
+PARROT_DYNEXT = $&#40;LIB_DIR&#41;/dynext<br />
+PERL6GRAMMAR  = $&#40;LIB_DIR&#41;/library/PGE/Perl6Grammar.pbc<br />
+NQP           = $&#40;LIB_DIR&#41;/languages/nqp/nqp.pbc<br />
+PCT           = $&#40;LIB_DIR&#41;/library/PCT.pbc<br />
 PMC_DIR       = src/pmc<br />
-OPSDIR        = src/ops<br />
+OPS_DIR       = src/ops<br />
 OPSLIB        = perl6<br />
-OPS_FILE      = src/ops/perl6.ops<br />
+OPS_FILE      = $&#40;OPS_DIR&#41;/perl6.ops<br />
 <br />
<div class="message-stanza-depth-1">
 # Set up extensions<br />
</div>
 <br />
<div class="message-stanza-depth-1">
 # Setup some commands<br />
</div>
-PARROT        = $&#40;BUILD_DIR&#41;/parrot$&#40;EXE&#41;<br />
+PARROT        = $&#40;BIN_DIR&#41;/parrot$&#40;EXE&#41;<br />
 CAT           = $&#40;PERL&#41; -MExtUtils::Command -e cat<br />
-BUILD_DYNPMC  = $&#40;PERL&#41; $&#40;BUILD_DIR&#41;/tools/build/dynpmc.pl<br />
-BUILD_DYNOPS  = $&#40;PERL&#41; $&#40;BUILD_DIR&#41;/tools/build/dynoplibs.pl<br />
-RECONFIGURE   = $&#40;PERL&#41; $&#40;BUILD_DIR&#41;/tools/dev/reconfigure.pl<br />
-PBC_TO_EXE    = $&#40;BUILD_DIR&#41;/pbc_to_exe$&#40;EXE&#41;<br />
+PBC_TO_EXE    = $&#40;BIN_DIR&#41;/pbc_to_exe$&#40;EXE&#41;<br />
 <br />
 SOURCES = perl6.pir \<br />
   src/gen_grammar.pir \<br />
@@ -43,7 +43,7 @@ SOURCES = perl6.pir \<br />
   src/parser/methods.pir \<br />
   src/parser/quote_expression.pir \<br />
   $&#40;PERL6_GROUP&#41; \<br />
-  src/ops/perl6_ops$&#40;LOAD_EXT&#41;<br />
+  $&#40;OPS_DIR&#41;/perl6_ops$&#40;LOAD_EXT&#41;<br />
 <br />
 BUILTINS_PIR = \<br />
   src/classes/ClassHOW.pir \<br />
@@ -110,8 +110,6 @@ SETTING = \<br />
   src/setting/Pair.pm \<br />
   src/setting/Whatever.pm \<br />
 <br />
-PMCS        = perl6str objectref perl6scalar mutablevar perl6multisub<br />
-<br />
 PMC_SOURCES = $&#40;PMC_DIR&#41;/perl6str.pmc $&#40;PMC_DIR&#41;/objectref.pmc $&#40;PMC_DIR&#41;/perl6scalar.pmc \<br />
               $&#40;PMC_DIR&#41;/mutablevar.pmc $&#40;PMC_DIR&#41;/perl6multisub.pmc<br />
 <br />
@@ -157,7 +155,7 @@ all: perl6$&#40;EXE&#41;<br />
<div class="message-stanza-depth-1">
 # &#40;We&#39;re not quite ready to make this a default target.&#41;<br />
</div>
 perl6$&#40;EXE&#41;: perl6.pbc<br />
        $&#40;PBC_TO_EXE&#41; perl6.pbc<br />
-       @win32_libparrot_copy@<br />
+#IF&#40;win32&#41;:    copy $&#40;LIB_DIR&#41;\libparrot.dll .<br />
 <br />
 spectest_checkout : t/spec<br />
 <br />
@@ -190,7 +188,7 @@ Test.pir: Test.pm perl6.pbc<br />
        $&#40;PARROT&#41; $&#40;PARROT_ARGS&#41; perl6.pbc --target=pir --output=Test.pir Test.pm<br />
 <br />
 $&#40;PMC_DIR&#41;/objectref.pmc : $&#40;PMC_DIR&#41;/objectref_pmc.template build/gen_objectref_pmc.pl<br />
-       $&#40;PERL&#41; -I$&#40;BUILD_DIR&#41;/lib build/gen_objectref_pmc.pl $&#40;PMC_DIR&#41;/objectref_pmc.template \<br />
+       $&#40;PERL&#41; -I$&#40;TOOLS_DIR&#41; build/gen_objectref_pmc.pl $&#40;PMC_DIR&#41;/objectref_pmc.template \<br />
                $&#40;PMC_DIR&#41;/objectref.pmc<br />
 <br />
 src/gen_grammar.pir: $&#40;PERL6GRAMMAR&#41; src/parser/grammar.pg src/parser/grammar-oper.pg<br />
@@ -214,17 +212,11 @@ src/gen_junction.pir: build/gen_junction_pir.pl<br />
 src/gen_setting.pm: build/gen_setting_pm.pl $&#40;SETTING&#41;<br />
        $&#40;PERL&#41; build/gen_setting_pm.pl $&#40;SETTING&#41; &gt; src/gen_setting.pm<br />
 <br />
-$&#40;PERL6_GROUP&#41;: $&#40;PARROT&#41; $&#40;PMC_SOURCES&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; generate $&#40;PMCS&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; compile $&#40;PMCS&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; linklibs $&#40;PMCS&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; copy --destination=$&#40;PARROT_DYNEXT&#41; $&#40;PMCS&#41;<br />
-<br />
-src/ops/perl6_ops$&#40;LOAD_EXT&#41; : $&#40;OPS_FILE&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; generate $&#40;OPSLIB&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; compile $&#40;OPSLIB&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; linklibs $&#40;OPSLIB&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; copy &#34;--destination=$&#40;PARROT_DYNEXT&#41;&#34; $&#40;OPSLIB&#41;<br />
+$&#40;PERL6_GROUP&#41;: $&#40;PARROT&#41; $&#40;PMC_SOURCES&#41; $&#40;PMC_DIR&#41;/Makefile<br />
+       $&#40;MAKE&#41; $&#40;PMC_DIR&#41;<br />
+<br />
+$&#40;OPS_DIR&#41;/perl6_ops$&#40;LOAD_EXT&#41; : $&#40;OPS_FILE&#41; $&#40;OPS_DIR&#41;/Makefile<br />
+       $&#40;MAKE&#41; $&#40;OPS_DIR&#41;<br />
 <br />
 <br />
<div class="message-stanza-depth-1">
 ##  local copy of Parrot<br />
</div>
diff --git a/build/ops_makefile.in b/build/ops_makefile.in<br />
new file mode 100644<br />
index 0000000..94e9298<br />
--- /dev/null<br />
+++ b/build/ops_makefile.in<br />
@@ -0,0 +1,56 @@<br />
+# Copyright &#40;C&#41; 2009, The Perl Foundation.<br />
+# $Id: $<br />
+<br />
+PERL          = @perl@<br />
+RM_F          = @rm_f@<br />
+CHMOD         = @chmod@<br />
+CP            = @cp@<br />
+VERSION_DIR   = @versiondir@<br />
+INCLUDE_DIR   = @includedir@$&#40;VERSION_DIR&#41;<br />
+LIB_DIR       = @libdir@$&#40;VERSION_DIR&#41;<br />
+INSTALL_DIR   = ..@slash@..@slash@dynext<br />
+O             = @o@<br />
+LOAD_EXT      = @load_ext@<br />
+CC            = @cc@ -c<br />
+LD            = @ld@<br />
+LDFLAGS       = @ldflags@ @ld_debug@ @rpath_blib@ @linkflags@<br />
+LD_LOAD_FLAGS = @ld_load_flags@<br />
+CFLAGS        = @ccflags@ @cc_shared@ @cc_debug@ @ccwarn@ @cc_hasjit@ @cg_flag@ @gc_flag@<br />
+CC_OUT        = @cc_o_out@<br />
+LD_OUT        = @ld_out@<br />
+#IF&#40;parrot_is_shared&#41;:LIBPARROT = @libparrot_ldflags@<br />
+#ELSE:LIBPARROT =<br />
+<br />
+BUILD_TOOLS_DIR = $&#40;LIB_DIR&#41;@slash@tools@slash@build<br />
+OPS2C           = $&#40;PERL&#41; $&#40;BUILD_TOOLS_DIR&#41;@slash <!-- x --> at ops2c.pl<br />
+<br />
+INCLUDES        = -I$&#40;INCLUDE_DIR&#41; -I$&#40;INCLUDE_DIR&#41;@slash@pmc<br />
+LINKARGS        = $&#40;LDFLAGS&#41; $&#40;LD_LOAD_FLAGS&#41; $&#40;LIBPARROT&#41;<br />
+<br />
+OPS_FILE = perl6.ops<br />
+<br />
+<br />
+all : install<br />
+<br />
+generate : $&#40;OPS_FILE&#41;<br />
+       $&#40;OPS2C&#41; C --dynamic $&#40;OPS_FILE&#41;<br />
+       $&#40;OPS2C&#41; CSwitch --dynamic $&#40;OPS_FILE&#41;<br />
+#IF&#40;cg_flag&#41;:  $&#40;OPS2C&#41; CGoto --dynamic $&#40;OPS_FILE&#41;<br />
+#IF&#40;cg_flag&#41;:  $&#40;OPS2C&#41; CGP --dynamic $&#40;OPS_FILE&#41;<br />
+<br />
+compile : generate<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; perl6_ops$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6_ops.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; perl6_ops_switch$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6_ops_switch.c<br />
+#IF&#40;cg_flag&#41;:  $&#40;CC&#41; $&#40;CC_OUT&#41; perl6_ops_cg$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6_ops_cg.c<br />
+#IF&#40;cg_flag&#41;:  $&#40;CC&#41; $&#40;CC_OUT&#41; perl6_ops_cgp$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6_ops_cgp.c<br />
+<br />
+linklibs : compile<br />
+       $&#40;LD&#41; $&#40;LD_OUT&#41; perl6_ops$&#40;LOAD_EXT&#41; perl6_ops$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+       $&#40;LD&#41; $&#40;LD_OUT&#41; perl6_ops_switch$&#40;LOAD_EXT&#41; perl6_ops_switch$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+#IF&#40;cg_flag&#41;:  $&#40;LD&#41; $&#40;LD_OUT&#41; perl6_ops_cg$&#40;LOAD_EXT&#41; perl6_ops_cg$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+#IF&#40;cg_flag&#41;:  $&#40;LD&#41; $&#40;LD_OUT&#41; perl6_ops_cgp$&#40;LOAD_EXT&#41; perl6_ops_cgp$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+<br />
+install : linklibs<br />
+#IF&#40;cygwin or hpux&#41;:   CHMOD 0775 &#34;*$&#40;LOAD_EXT&#41;&#34;<br />
+       $&#40;CP&#41; &#34;*$&#40;LOAD_EXT&#41;&#34; $&#40;INSTALL_DIR&#41;<br />
+<br />
diff --git a/build/pmc_makefile.in b/build/pmc_makefile.in<br />
new file mode 100644<br />
index 0000000..40d71e2<br />
--- /dev/null<br />
+++ b/build/pmc_makefile.in<br />
@@ -0,0 +1,73 @@<br />
+# Copyright &#40;C&#41; 2009, The Perl Foundation.<br />
+# $Id: $<br />
+<br />
+PERL          = @perl@<br />
+RM_F          = @rm_f@<br />
+CHMOD         = @chmod@<br />
+CP            = @cp@<br />
+VERSION_DIR   = @versiondir@<br />
+INCLUDE_DIR   = @includedir@$&#40;VERSION_DIR&#41;<br />
+LIB_DIR       = @libdir@$&#40;VERSION_DIR&#41;<br />
+SRC_DIR       = @srcdir@$&#40;VERSION_DIR&#41;<br />
+INSTALL_DIR   = ../../dynext<br />
+O             = @o@<br />
+LOAD_EXT      = @load_ext@<br />
+CC            = @cc@ -c<br />
+LD            = @ld@<br />
+LDFLAGS       = @ldflags@ @ld_debug@<br />
+LD_LOAD_FLAGS = @ld_load_flags@<br />
+CFLAGS        = @ccflags@ @cc_shared@ @cc_debug@ @ccwarn@ @cc_hasjit@ @cg_flag@ @gc_flag@<br />
+CC_OUT        = @cc_o_out@<br />
+LD_OUT        = @ld_out@<br />
+#IF&#40;parrot_is_shared&#41;:LIBPARROT = @libparrot_ldflags@<br />
+#ELSE:LIBPARROT =<br />
+<br />
+BUILD_TOOLS_DIR = $&#40;LIB_DIR&#41;@slash@tools@slash@build<br />
+PMC2C_INCLUDES  = --include $&#40;SRC_DIR&#41; --include $&#40;SRC_DIR&#41;@slash@pmc<br />
+PMC2C           = $&#40;PERL&#41; $&#40;BUILD_TOOLS_DIR&#41;@slash <!-- x --> at pmc2c.pl<br />
+PMC2CD = $&#40;PMC2C&#41; --dump $&#40;PMC2C_INCLUDES&#41;<br />
+PMC2CC = $&#40;PMC2C&#41; --c $&#40;PMC2C_INCLUDES&#41;<br />
+<br />
+INCLUDES        = -I$&#40;INCLUDE_DIR&#41; -I$&#40;INCLUDE_DIR&#41;@slash@pmc<br />
+LINKARGS        = $&#40;LDFLAGS&#41; $&#40;LD_LOAD_FLAGS&#41; $&#40;LIBPARROT&#41;<br />
+<br />
+PMC_SOURCES = \<br />
+  perl6str.pmc \<br />
+  objectref.pmc \<br />
+  perl6scalar.pmc \<br />
+  mutablevar.pmc \<br />
+  perl6multisub.pmc<br />
+<br />
+PERL6_GROUP = perl6_group<br />
+<br />
+<br />
+all : install<br />
+<br />
+generate : $&#40;PMC_SOURCES&#41;<br />
+       $&#40;PMC2CD&#41; perl6str.pmc<br />
+       $&#40;PMC2CD&#41; objectref.pmc<br />
+       $&#40;PMC2CD&#41; perl6scalar.pmc<br />
+       $&#40;PMC2CD&#41; mutablevar.pmc<br />
+       $&#40;PMC2CD&#41; perl6multisub.pmc<br />
+       $&#40;PMC2CC&#41; perl6str.pmc<br />
+       $&#40;PMC2CC&#41; objectref.pmc<br />
+       $&#40;PMC2CC&#41; perl6scalar.pmc<br />
+       $&#40;PMC2CC&#41; mutablevar.pmc<br />
+       $&#40;PMC2CC&#41; perl6multisub.pmc<br />
+       $&#40;PMC2C&#41; --library $&#40;PERL6_GROUP&#41; --c $&#40;PMC_SOURCES&#41;<br />
+<br />
+compile : generate<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; perl6str$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6str.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; objectref$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; objectref.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; perl6scalar$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6scalar.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; mutablevar$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; mutablevar.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; perl6multisub$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6multisub.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; lib-$&#40;PERL6_GROUP&#41;$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; $&#40;PERL6_GROUP&#41;.c<br />
+<br />
+linklibs : compile<br />
+       $&#40;LD&#41; $&#40;LD_OUT&#41; $&#40;PERL6_GROUP&#41;$&#40;LOAD_EXT&#41; lib-$&#40;PERL6_GROUP&#41;$&#40;O&#41; perl6str$&#40;O&#41; objectref$&#40;O&#41; perl6scalar$&#40;O&#41; mutablevar$&#40;O&#41; perl6multisub$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+<br />
+install : linklibs<br />
+#IF&#40;cygwin or hpux&#41;:   CHMOD 0775 &#34;*$&#40;LOAD_EXT&#41;&#34;<br />
+       $&#40;CP&#41; &#34;*$&#40;LOAD_EXT&#41;&#34; $&#40;INSTALL_DIR&#41;<br />
+<br />
-- <br />
1.5.6.3<br />
</div>
</div>
</div>
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction other even">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-534556" href="/rt3/Ticket/Display.html?id=63360#txn-534556">#</a>
      &nbsp;
    </td>
    <td class="date">Fri&nbsp;Feb&nbsp;20&nbsp;00:36:39&nbsp;2009</td>
    <td class="description">
      RT_System -  Tag Patch added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction message odd">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-535378" href="/rt3/Ticket/Display.html?id=63360#txn-535378">#</a>
      &nbsp;
    </td>
    <td class="date">Mon&nbsp;Feb&nbsp;23&nbsp;18:05:50&nbsp;2009</td>
    <td class="description">
      allison -  Correspondence added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
</table>
<div class="messagebody">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/535378/253860/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 354b]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
On Fri Feb 20 00:36:36 2009, allison <!-- x --> at perl.org wrote:<br />
<div class="message-stanza-depth-1">
&gt; <br />
&gt; - There&#39;s still a problem with the installed test libraries. I&#39;ll look <br />
&gt; into it and provide an additional patch.<br />
</div>
<br />
Ah, it wasn&#39;t a problem with the test libraries, just with Rakudo&#39;s<br />
t/harness &#40;using a hardcoded path to the parrot executable&#41;. Attached<br />
git patch to fix the test target.<br />
<br />
Allison<br />
</div>
</div>
</div>
<table>
</table>
<div class="messagebody">
<table>
</table>
<div class="messagebody">
<div class="message-stanza-depth-0">

</div>
</div>
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/535378/253866/rakudo_test_from_installed_parrot.patch">Download rakudo_test_from_installed_parrot.patch</a>
<span class="downloadcontenttype">
[text/x-diff 2.1k]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
From 90672654a8f2600dbc8b67f4f46286d1ed2b7279 Mon Sep 17 00:00:00 2001<br />
From: Allison Randal &lt;allison <!-- x --> at parrot.org&gt;<br />
Date: Mon, 23 Feb 2009 18:03:30 -0800<br />
Subject: [PATCH] Also fix t/harness to use installed Parrot executable when requested, instead of looking for the executable in a &#39;parrot/&#39; subdirectory.<br />
<br />
---<br />
 build/Makefile.in |    4 ++--<br />
 t/harness         |   16 ++++++++++------<br />
 2 files changed, 12 insertions&#40;+&#41;, 8 deletions&#40;-&#41;<br />
<br />
diff --git a/build/Makefile.in b/build/Makefile.in<br />
index 3244ff0..9c88b2e 100644<br />
--- a/build/Makefile.in<br />
+++ b/build/Makefile.in<br />
@@ -149,7 +149,7 @@ CLEANUPS = \<br />
 <br />
<div class="message-stanza-depth-1">
 # NOTE: eventually, we should remove --keep-exit-code and --fudge<br />
 #       as the goal is that all tests must pass without fudge<br />
</div>
-HARNESS_WITH_FUDGE = $&#40;PERL&#41; t/harness --fudge --keep-exit-code<br />
+HARNESS_WITH_FUDGE = $&#40;PERL&#41; -I$&#40;TOOLS_DIR&#41; t/harness --bindir=$&#40;BIN_DIR&#41; --fudge --keep-exit-code<br />
 HARNESS_WITH_FUDGE_JOBS = $&#40;HARNESS_WITH_FUDGE&#41; --jobs<br />
 <br />
 <br />
@@ -243,7 +243,7 @@ codetest:<br />
 <br />
 coretest: perl6.pbc<br />
<div class="message-stanza-depth-1">
 #      prove t/pmc<br />
</div>
-       $&#40;PERL&#41; t/harness t/00-parrot t/01-sanity<br />
+       $&#40;PERL&#41; -I$&#40;TOOLS_DIR&#41; t/harness --bindir=$&#40;BIN_DIR&#41; t/00-parrot t/01-sanity<br />
 <br />
 fulltest: coretest spectest codetest<br />
 <br />
diff --git a/t/harness b/t/harness<br />
index 48f2aab..26327fe 100644<br />
--- a/t/harness<br />
+++ b/t/harness<br />
@@ -20,21 +20,25 @@ our %harness_args = &#40;<br />
     verbosity =&gt; 0,<br />
 &#41;;<br />
 <br />
-if &#40;-d &#39;parrot&#39;&#41; {<br />
-    $harness_args{exec}     = [&#39;parrot/parrot&#39;, &#39;perl6.pbc&#39;];<br />
-} else {<br />
-    $harness_args{compiler} = &#39;perl6.pbc&#39;;<br />
-}<br />
-<br />
 GetOptions&#40;<br />
         &#39;tests-from-file=s&#39; =&gt; \my $list_file,<br />
         &#39;fudge&#39;             =&gt; \my $do_fudge,<br />
         &#39;verbosity=i&#39;       =&gt; \$harness_args{verbosity},<br />
+        &#39;bindir=s&#39;          =&gt; \$harness_args{bindir},<br />
<div class="message-stanza-depth-1">
         # A sensible default is num_cores + 1.<br />
         # Many people have two cores these days.<br />
</div>
         &#39;jobs:3&#39;            =&gt; \$harness_args{jobs},<br />
     &#41;;<br />
 <br />
+if &#40;$harness_args{bindir}&#41; {<br />
+    $harness_args{exec}     = [$harness_args{bindir}.&#39;/parrot&#39;, &#39;perl6.pbc&#39;];<br />
+} elsif &#40;-d &#39;parrot&#39;&#41; {<br />
+    $harness_args{exec}     = [&#39;parrot/parrot&#39;, &#39;perl6.pbc&#39;];<br />
+} else {<br />
+    $harness_args{compiler} = &#39;perl6.pbc&#39;;<br />
+}<br />
+<br />
+<br />
 <br />
 my @pass_through_options = grep m/^--?[^-]/, @ARGV;<br />
 my @files = grep m/^[^-]/, @ARGV;<br />
-- <br />
1.5.6.3<br />
</div>
</div>
</div>
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction basics even">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-535382" href="/rt3/Ticket/Display.html?id=63360#txn-535382">#</a>
      <a name="lasttrans">&nbsp;</a>
    </td>
    <td class="date">Mon&nbsp;Feb&nbsp;23&nbsp;18:05:53&nbsp;2009</td>
    <td class="description">
      RT_System -  Status changed from &#39;new&#39; to &#39;open&#39;
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
    </td>
  </tr>

</table>
</div>


</div>
    <hr class="clear" />
  </div>
</div>




 


</div>
<hr size=0>
<div>
For issues related to this RT instance (aka "perlbug"), please contact <tt>perlbug-admin at perl.org</tt>
</div>


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-50555-18");
pageTracker._initData();
pageTracker._trackPageview();
</script>

<div id="footer">
  <p id="time">
    <span>Time to display: 1.477529</span>
  </p>

  <p id="bpscredits">
    <span>
&#187;&#124;&#171; RT 3.6.HEAD Copyright 1996-2006 <a href="http://www.bestpractical.com?rt=3.6.HEAD">Best Practical Solutions, LLC</a>.
</span>
</p>

</div>

  </body>
</html>
